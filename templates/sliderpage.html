{% load static %}
<!DOCTYPE html>
<html lang="en">
<html>
<head>
	<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title></title>
	<link href="https://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

</head>
<body>
	<hr>
<div class="container-fluid">
<div class="row mx-0 px-0 justify-content-center">

	<div class="col-3 col-sm-3 col-md-3 col-lg-3 col-xl-3 col-xxl-3 ml-0 mr-5 bg-light">
	<!-- LEFT COLUMN -->

		<p class="text-start"><b>Рубрика:</b> Космос </p>
		<p class="text-start"><b>Автор:</b> Фамилия, Имя </p>
		<p class="text-start">
			<label for="topc" class="form-label"><b>Заголовок:</b> </label>
			<input class="form-control" type="text" id="topc" aria-label="default input example">

		</p>
		<p class="text-start"><b>Редактировалась:</b> раз </p>
		<p class="text-start"><b>Последняя правка:</b> Дата, время </p>
		<p class="text-start"><b>Статус:</b> (опубликована, на рассмотрении гл.редактора, новая, возврат) </p>
		<p class="text-start"><b>Deadline:</b> Дата, время </p>
		<p class="text-start">
		    <label for="leadin" class="form-label"><b>Подводка:</b> </label>
		    <textarea type="text" class="form-control" id="leadin"> </textarea>
		</p>


		 
		<p class="text-start"><b>Иконка:</b> <button type="button" class="btn btn-outline-dark">Добавить</button> </p>
		<!--<button class="btn btn-dark btn-block" onclick="renderNews()">Сверстать страницу</button>-->
		<a href="/" class="btn btn-dark btn-block" role="button">Вернуться</a>



	</div>

	<div class="col-6 col-sm-6 col-md-6 col-lg-6 col-xl-5 col-xxl-6 mx-0 px-0 ">
	<!-- CENTRAL COLUMN -->
		<div id="editors" class="container float mx-0 px-0">
			<div class="row bg-light p-5 mb-1">
				<div class="col-12 m-0 p-0">
					<!-- SLIDER -->
					{% if slider_instance %}{% autoescape off %}{{slider_instance.content}}{% endautoescape %} {% else %}

					


					<div id="car0" class="row mt-5">
					<div id="sliderExample" class="carousel slide" data-ride="carousel">
						<!-- Controls -->
						<ol class="carousel-indicators">
							<li data-target="#sliderExample" data-slide-to="0" class="active"></li>
						</ol>
						<!-- Slides -->
						<div class="carousel-inner">
							<div class="carousel-item active">
					    		<svg class="bd-placeholder-img bd-placeholder-img-lg d-block w-100" width="800" height="400" xmlns="http://www.w3.org/2000/svg" role="img" preserveAspectRatio="xMidYMid slice" focusable="false"><rect width="100%" height="100%" fill="#777"></rect></svg>
					        	<div class="carousel-caption d-none d-md-block">
					                <h5>Заголовок слайда</h5>
					                <p>Текст подписи</p>
					        	</div>
							</div>
						</div>
						<a class="carousel-control-prev" href="#sliderExample" role="button" data-slide="prev">
							<span class="carousel-control-prev-icon" aria-hidden="true"></span>
							<span class="sr-only">Назад</span>
						</a>
						<a class="carousel-control-next" href="#sliderExample" role="button" data-slide="next">
							<span class="carousel-control-next-icon" aria-hidden="true"></span>
							<span class="sr-only">Вперёд</span>
						</a>
					</div>
				</div>
				{% endif %}
					




				</div>
				
			</div>
		</div>


	</div>

	<div class="col-3 col-sm-3 col-md-3 col-lg-3 col-xl-3 col-xxl-3 ml-5 mr-0 bg-light text-center">
	<!-- RIGHT COLUMN -->
		{% for sl in slides %}
		<div class="row mx-0 p-3 justify-content-center">

			<div class="card border rounded border-white shadow" style="width: 18rem;">
				<img src="{{ sl.0.img.image.url }}" class="card-img-top" onclick="changeFile('{{sl.0.pk}}');">		
				<input type="file" id="chFile{{sl.0.pk}}" class="inputfile" onchange="updFile(this, '{{sl.0.pk}}')" style="width: 0.1px; height: 0.1px; opacity: 0; overflow: hidden; position: absolute; z-index: -1;" />
						
				
				<div class="card-body">
					<h5 id="h{{sl.0.pk}}" class="card-title" onclick="replaceText(this, '{{sl.0.pk}}', `{{sl.0.label}}`)">
						{%if sl.0.label%}{{sl.0.label}}{%else%}...{%endif%}
					</h5>
					<p id="p{{sl.0.pk}}" class="card-text" onclick="replaceText(this, '{{sl.0.pk}}', `{{sl.0.descr}}`)">{%if sl.0.descr%}{{sl.0.descr}}{%else%}...{%endif%}</p>
					<form class="row px-5 justify-content-center" method="POST" enctype="application/x-www-form-urlencoded" novalidate >
					{% csrf_token %}
					<button class="btn btn-danger btn-sm border mt-2" name="delBtn" type="submit" value="{{sl.0.pk}}">Удалить</button>
					{% if sl.1 %}
					<button class="btn btn-info btn-sm border mt-2" name="remBtn" type="submit" value="{{sl.0.pk}}">Убрать</button>
					{% else %}
					<button class="btn btn-success btn-sm border mt-2" name="insBtn" type="submit" value="{{sl.0.pk}}">Вставить</button>
					{% endif %}
					
					</form>
				</div>

			</div>
		

		</div>
		{% endfor %}


		<div class="row mx-0 p-3 justify-content-center">

		<form class="row px-5" method="POST" enctype="multipart/form-data" novalidate >
			{% csrf_token %}

			<div class="card border rounded border-white shadow" style="width: 18rem;">
				<input type="file" name="file" id="slFile" onchange="addFile(this)" class="inputfile" style="width: 0.1px; height: 0.1px; opacity: 0; overflow: hidden; position: absolute; z-index: -1;" />
				<label id="loadDescr" class="btn border btn-secondary" for="slFile" style="height: 6rem;"><p class="text-start mt-4">Клик для выбора файла</p></label>
				<div class="card-body">
					<input type="text" class="form-control my-1" name="label" placeholder="Заголовок (необяз.)">
					<input type="text" class="form-control my-1" name="descr" placeholder="Подпись (необяз.)">
					<button id="loadBtn" class="btn btn-success border mt-2" type="submit" disabled>Добавить</button>
				</div>
			</div>		
			
		</form>
		</div>

		
	
	</div>


</div>
</div>




	<div id="controls" class="container float">
		<div class="row my-5">
			<div class="col-2"></div>
			
			<div class="col-2"></div>
			<div class="col-2"></div>
		</div>

		<div class="row my-5">
			<div class="col-2"></div>
			<div class="col-8"></div>
			<div class="col-2"></div>
		</div>
	</div>



<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<script type="text/javascript">


function addFile(item) {
	var fname = item.value.replace(/.*[\/\\]/, '');
	el = document.getElementById("loadDescr").outerHTML = `<label id="loadDescr" class="btn border btn-success" for="file" style="height: 6rem;"><p class="text-start mt-4">${fname}</p></label>`;
	var loadBtn = document.getElementById("loadBtn").disabled = false;
}

function changeFile(pk){
	var elem = document.getElementById(`chFile${pk}`);
	if(elem && document.createEvent) {
      var evt = document.createEvent("MouseEvents");
      evt.initEvent("click", true, false);
      elem.dispatchEvent(evt);
   }

}

function updFile(item, pk){
   let formData = new FormData();
   formData.append("photo", item.files[0]);
   formData.append("name", pk);
   fetch("", {method: "POST", headers:{"X-CSRFToken": '{{ csrf_token }}'}, body: formData}).then(() => location.replace(document.URL));
}


function replaceText(item, pk, val){
	document.getElementById(item.id).outerHTML = `<input id="${item.id}" type="text" class="form-control my-1" value="${val}">
	<button id="b${item.id}" class="btn btn-info btn-sm border mt-2" type="submit" onclick="updText(this, '${item.id}', '${item.className}', ${pk})">Обновить</button>`;
}

function updText(btn, itId, itCl, pk){
	let txt = document.getElementById(itId);
	let val = txt.value;
	txt.outerHTML = (itCl==="card-title")? `<h5 id="${itId}" class="card-title" onclick="replaceText(this, '${pk}', '${val}')">${(val==="")? '...': val}</h5>` : `<p id="${itId}" class="card-text" onclick="replaceText(this, '${pk}', '${val}')">${(val==="")? '...': val}</p>`;
	btn.parentNode.removeChild(btn);
	let formData = new FormData();
	formData.append("name", pk);
	formData.append("class", itCl);
	formData.append("val", val);
	fetch("", {method: "POST", headers:{"X-CSRFToken": '{{ csrf_token }}'}, body: formData}).then(() => location.replace(document.URL));
}


</script>
</body>
</html>
